<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Divine Games Festival - Journey through the Five Realms">
  <meta name="theme-color" content="#d97706">
  <title>Divine Games Festival - Spiritual Journey</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Splash Screen Styles */
    .splash-screen {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 25%, #ea580c 50%, #dc2626 75%, #9333ea 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      animation: gradientShift 8s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 25%, #ea580c 50%, #dc2626 75%, #9333ea 100%);
      }
      50% {
        background: linear-gradient(135deg, #9333ea 0%, #dc2626 25%, #ea580c 50%, #f59e0b 75%, #fbbf24 100%);
      }
    }

    .splash-content {
      text-align: center;
      position: relative;
      animation: fadeInUp 1s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .spiritual-path {
      position: relative;
      width: 400px;
      height: 200px;
      margin: 40px auto;
    }

    .path-line {
      position: absolute;
      bottom: 60px;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 2px;
      overflow: hidden;
    }

    .path-line::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% {
        left: -100%;
      }
      100% {
        left: 100%;
      }
    }

    .monkey-walker {
      position: absolute;
      bottom: 45px;
      left: 0;
      font-size: 60px;
      animation: walkPath 4s ease-in-out infinite;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
    }

    @keyframes walkPath {
      0%, 100% {
        left: 0;
        transform: translateX(0) scaleX(1);
      }
      48% {
        transform: translateX(0) scaleX(1);
      }
      50% {
        transform: translateX(0) scaleX(-1);
      }
      98%, 100% {
        left: calc(100% - 60px);
        transform: translateX(0) scaleX(-1);
      }
    }

    .spiritual-symbols {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      font-size: 80px;
      animation: glowPulse 3s ease-in-out infinite;
      filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
    }

    @keyframes glowPulse {
      0%, 100% {
        transform: translateX(-50%) scale(1);
        opacity: 0.8;
      }
      50% {
        transform: translateX(-50%) scale(1.1);
        opacity: 1;
      }
    }

    .floating-elements {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
    }

    .floating-particle {
      position: absolute;
      font-size: 24px;
      opacity: 0;
      animation: float 6s ease-in-out infinite;
    }

    .floating-particle:nth-child(1) { left: 10%; animation-delay: 0s; }
    .floating-particle:nth-child(2) { left: 20%; animation-delay: 1s; }
    .floating-particle:nth-child(3) { left: 30%; animation-delay: 2s; }
    .floating-particle:nth-child(4) { left: 40%; animation-delay: 0.5s; }
    .floating-particle:nth-child(5) { left: 50%; animation-delay: 1.5s; }
    .floating-particle:nth-child(6) { left: 60%; animation-delay: 2.5s; }
    .floating-particle:nth-child(7) { left: 70%; animation-delay: 1s; }
    .floating-particle:nth-child(8) { left: 80%; animation-delay: 2s; }
    .floating-particle:nth-child(9) { left: 90%; animation-delay: 0.8s; }

    @keyframes float {
      0% {
        bottom: -50px;
        opacity: 0;
        transform: translateX(0) rotate(0deg);
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        bottom: 100%;
        opacity: 0;
        transform: translateX(50px) rotate(360deg);
      }
    }

    .splash-title {
      color: white;
      font-size: 48px;
      font-weight: bold;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      margin-bottom: 10px;
      animation: titleGlow 2s ease-in-out infinite;
    }

    @keyframes titleGlow {
      0%, 100% {
        text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5), 0 0 40px rgba(255, 215, 0, 0.5);
      }
      50% {
        text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5), 0 0 60px rgba(255, 215, 0, 0.8);
      }
    }

    .splash-subtitle {
      color: rgba(255, 255, 255, 0.95);
      font-size: 20px;
      font-weight: 500;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      margin-top: 10px;
    }

    .splash-tagline {
      color: rgba(255, 255, 255, 0.85);
      font-size: 16px;
      font-style: italic;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      margin-top: 30px;
      animation: fadeIn 2s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .loading-dots {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 40px;
    }

    .dot {
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 50%;
      animation: bounce 1.4s ease-in-out infinite;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
    }

    .dot:nth-child(1) { animation-delay: 0s; }
    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }

    .splash-hidden {
      animation: fadeOut 0.8s ease-out forwards;
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: scale(0.95);
      }
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .5;
      }
    }

    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(-25%);
        animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
      }
      50% {
        transform: translateY(0);
        animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
      }
    }

    .animate-bounce {
      animation: bounce 1s infinite;
    }

    .loader {
      border: 4px solid #f3f4f6;
      border-top: 4px solid #d97706;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    video {
      width: 100%;
      height: auto;
      display: block;
    }

    #qr-reader {
      width: 100%;
    }

    #qr-reader__dashboard_section_csr {
      display: none !important;
    }

    #qr-reader video {
      border-radius: 12px;
    }

    /* Meditative breathing effect */
    .breath-circle {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 100px;
      border: 3px solid rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% {
        transform: translateX(-50%) scale(0.8);
        opacity: 0.4;
      }
      50% {
        transform: translateX(-50%) scale(1.2);
        opacity: 0.8;
      }
    }
  </style>
</head>
<body>
  <!-- Spiritual Splash Screen -->
  <div id="splash-screen" class="splash-screen">
    <!-- Floating particles background -->
    <div class="floating-elements">
      <div class="floating-particle">üå∏</div>
      <div class="floating-particle">‚ú®</div>
      <div class="floating-particle">ü™∑</div>
      <div class="floating-particle">üïâÔ∏è</div>
      <div class="floating-particle">üå∫</div>
      <div class="floating-particle">‚≠ê</div>
      <div class="floating-particle">üåº</div>
      <div class="floating-particle">üí´</div>
      <div class="floating-particle">üå∏</div>
    </div>

    <div class="splash-content">
      <h1 class="splash-title">üïâÔ∏è Divine Games Festival üïâÔ∏è</h1>
      <p class="splash-subtitle">Journey through the Five Realms</p>
      
      <!-- Spiritual path with walking monkey -->
      <div class="spiritual-path">
        <div class="spiritual-symbols">üôè</div>
        <div class="path-line"></div>
        <div class="monkey-walker">üêí</div>
        <div class="breath-circle"></div>
      </div>
      
      <p class="splash-tagline">"Walking the path of enlightenment, seeking divine wisdom"</p>
      
      <!-- Loading dots -->
      <div class="loading-dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
    </div>
  </div>

  <div id="root">
    <!-- Loading State (hidden initially) -->
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(to bottom right, #fef3c7, #fed7aa, #fef08a);">
      <div style="text-align: center;">
        <div class="loader" style="margin: 0 auto 20px;"></div>
        <p style="color: #92400e; font-weight: 600;">Loading Divine Games Festival...</p>
      </div>
    </div>
  </div>

  <!-- React and ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- HTML5 QR Code Library -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  
  <!-- Main Application -->
  <script>
    // Hide splash screen after loading
    window.addEventListener('load', () => {
      setTimeout(() => {
        const splash = document.getElementById('splash-screen');
        splash.classList.add('splash-hidden');
        setTimeout(() => {
          splash.style.display = 'none';
        }, 800);
      }, 3000); // Show splash for 3 seconds
    });

    const { useState, useEffect, useRef } = React;

    // Animal names for random username generation
    const ANIMAL_NAMES = [
      'Peacock', 'Elephant', 'Tiger', 'Lotus', 'Swan', 'Eagle', 'Dolphin', 'Deer',
      'Lion', 'Phoenix', 'Crane', 'Turtle', 'Butterfly', 'Hummingbird', 'Owl',
      'Falcon', 'Panda', 'Koala', 'Rabbit', 'Fox', 'Wolf', 'Bear', 'Raven', 'Dove',
      'Hawk', 'Sparrow', 'Parrot', 'Monkey', 'Zebra', 'Giraffe', 'Cheetah', 'Gazelle'
    ];

    // Stall configuration
    const STALLS = [
      { id: 'stall1', name: 'Harmony Haven', color: 'from-amber-400 to-orange-500', qrCode: 'STALL1_HARMONY_HAVEN' },
      { id: 'stall2', name: 'Wisdom Well', color: 'from-blue-400 to-indigo-500', qrCode: 'STALL2_WISDOM_WELL' },
      { id: 'stall3', name: 'Peace Pavilion', color: 'from-green-400 to-emerald-500', qrCode: 'STALL3_PEACE_PAVILION' },
      { id: 'stall4', name: 'Serenity Square', color: 'from-purple-400 to-pink-500', qrCode: 'STALL4_SERENITY_SQUARE' },
      { id: 'stall5', name: 'Bliss Bay', color: 'from-teal-400 to-cyan-500', qrCode: 'STALL5_BLISS_BAY' }
    ];

    // Reward tiers
    const REWARDS = [
      { threshold: 20, name: 'Seeker', icon: 'üå±', message: 'Your journey begins' },
      { threshold: 40, name: 'Explorer', icon: 'üåø', message: 'Keep discovering' },
      { threshold: 60, name: 'Wanderer', icon: 'üå∏', message: 'Halfway to enlightenment' },
      { threshold: 80, name: 'Sage', icon: '‚ú®', message: 'Wisdom grows within you' },
      { threshold: 100, name: 'Master', icon: 'üèÜ', message: 'Complete! Claim your gift!' }
    ];

    // Icon component wrapper
    const Icon = ({ name, className = "w-6 h-6" }) => {
      useEffect(() => {
        lucide.createIcons();
      }, []);
      return React.createElement('i', { 
        'data-lucide': name, 
        className: className 
      });
    };

    function SpiritualGamesApp() {
      const [view, setView] = useState('home');
      const [username, setUsername] = useState(localStorage.getItem('username') || '');
      const [visitedStalls, setVisitedStalls] = useState(
        JSON.parse(localStorage.getItem('visitedStalls') || '[]')
      );
      const [gamePoints, setGamePoints] = useState(
        JSON.parse(localStorage.getItem('gamePoints') || '{}')
      );
      const [players, setPlayers] = useState([]);
      const [selectedStall, setSelectedStall] = useState(null);
      const [adminPin, setAdminPin] = useState('');
      const [isAdmin, setIsAdmin] = useState(false);
      const [scanAnimation, setScanAnimation] = useState(false);
      const [showScanner, setShowScanner] = useState(false);
      const [cameraError, setCameraError] = useState(null);
      const [lastScannedCode, setLastScannedCode] = useState('');
      const [scanCooldown, setScanCooldown] = useState(false);
      const [showSuccessModal, setShowSuccessModal] = useState(false);
      const [scannedStallInfo, setScannedStallInfo] = useState(null);
      const scannerInstanceRef = useRef(null);

      // Generate random username
      const generateUsername = () => {
        const randomAnimal = ANIMAL_NAMES[Math.floor(Math.random() * ANIMAL_NAMES.length)];
        const randomNum = Math.floor(Math.random() * 900) + 100;
        return `${randomAnimal}${randomNum}`;
      };

      // Calculate scores
      const calculateVisitScore = (stalls) => stalls.length * 20;
      const calculateGamePoints = (points) => Object.values(points).reduce((sum, point) => sum + point, 0);
      const calculateCombinedScore = (visitScore, gamePointsTotal) => {
        const maxGamePoints = 500;
        const normalizedGameScore = Math.min((gamePointsTotal / maxGamePoints) * 100, 100);
        return Math.round((visitScore * 0.5) + (normalizedGameScore * 0.5));
      };

      const getCurrentScore = () => {
        const visitScore = calculateVisitScore(visitedStalls);
        const gamePointsTotal = calculateGamePoints(gamePoints);
        return calculateCombinedScore(visitScore, gamePointsTotal);
      };

      const getCurrentReward = () => {
        const visitScore = calculateVisitScore(visitedStalls);
        for (let i = REWARDS.length - 1; i >= 0; i--) {
          if (visitScore >= REWARDS[i].threshold) return REWARDS[i];
        }
        return null;
      };

      // Handle QR scan
      const handleQRScan = (decodedText) => {
        if (!decodedText || scanCooldown) return;
        if (decodedText === lastScannedCode) return;
        
        setLastScannedCode(decodedText);
        setScanCooldown(true);
        setTimeout(() => setScanCooldown(false), 3000);

        const stall = STALLS.find(s => decodedText.includes(s.qrCode) || decodedText.includes(s.id));
        
        if (stall) {
          if (!username) {
            const newUsername = generateUsername();
            setUsername(newUsername);
            localStorage.setItem('username', newUsername);
          }

          if (!visitedStalls.includes(stall.id)) {
            const newVisited = [...visitedStalls, stall.id];
            setVisitedStalls(newVisited);
            localStorage.setItem('visitedStalls', JSON.stringify(newVisited));
            updatePlayersList(newVisited);
            
            setScannedStallInfo(stall);
            setShowSuccessModal(true);
            setScanAnimation(true);
            setTimeout(() => setScanAnimation(false), 2000);
            
            setTimeout(() => {
              stopScanner();
              setShowSuccessModal(false);
              setView('home');
            }, 3000);
          } else {
            alert(`You've already visited ${stall.name}!`);
          }
        } else {
          alert('Invalid QR code. Please scan a valid stall QR code.');
        }
      };

      // Scanner functions
      const startScanner = async () => {
        if (scannerInstanceRef.current) return;

        // First set showScanner to true so the div renders
        setShowScanner(true);

        // Wait for next tick to ensure DOM is updated
        await new Promise(resolve => setTimeout(resolve, 100));

        // Check if element exists
        const element = document.getElementById("qr-reader");
        if (!element) {
          setCameraError('Scanner initialization failed. Please try again.');
          return;
        }

        try {
          const html5QrCode = new Html5Qrcode("qr-reader");
          scannerInstanceRef.current = html5QrCode;

          await html5QrCode.start(
            { facingMode: "environment" },
            { fps: 10, qrbox: { width: 250, height: 250 } },
            handleQRScan,
            () => {} // error handler
          );
          
          setCameraError(null);
        } catch (err) {
          console.error('Camera error:', err);
          setShowScanner(false);
          if (err.name === 'NotAllowedError' || err.message?.includes('Permission')) {
            setCameraError('Camera permission denied. Please allow camera access and try again.');
          } else if (err.name === 'NotFoundError') {
            setCameraError('No camera found on this device.');
          } else {
            setCameraError('Unable to access camera. This feature requires HTTPS. Please deploy the app to test camera scanning.');
          }
        }
      };

      const stopScanner = async () => {
        if (scannerInstanceRef.current) {
          try {
            await scannerInstanceRef.current.stop();
            scannerInstanceRef.current.clear();
            scannerInstanceRef.current = null;
          } catch (err) {
            console.error('Error stopping scanner:', err);
          }
        }
        setShowScanner(false);
      };

      const openScanner = () => {
        setCameraError(null);
        setView('scanner');
        setShowScanner(false); // Reset scanner state
        // Don't start scanner immediately, let user click the button
      };

      // Update players list
      const updatePlayersList = (visited = visitedStalls) => {
        const visitScore = calculateVisitScore(visited);
        const gamePointsTotal = calculateGamePoints(gamePoints);
        const currentScore = calculateCombinedScore(visitScore, gamePointsTotal);
        
        const allPlayers = JSON.parse(localStorage.getItem('allPlayers') || '[]');
        const playerIndex = allPlayers.findIndex(p => p.username === username);
        
        const playerData = {
          username,
          visitScore,
          gamePoints: gamePointsTotal,
          gamePointsDetail: gamePoints,
          visitedStalls: visited,
          combinedScore: currentScore,
          timestamp: Date.now()
        };

        if (playerIndex >= 0) {
          allPlayers[playerIndex] = playerData;
        } else {
          allPlayers.push(playerData);
        }

        localStorage.setItem('allPlayers', JSON.stringify(allPlayers));
        setPlayers(allPlayers);
      };

      // Admin functions
      const addGamePoints = (playerUsername, stallId, points) => {
        const allPlayers = JSON.parse(localStorage.getItem('allPlayers') || '[]');
        const playerIndex = allPlayers.findIndex(p => p.username === playerUsername);
        
        if (playerIndex >= 0) {
          if (!allPlayers[playerIndex].gamePointsDetail) {
            allPlayers[playerIndex].gamePointsDetail = {};
          }
          allPlayers[playerIndex].gamePointsDetail[stallId] = points;
          
          const totalGamePoints = Object.values(allPlayers[playerIndex].gamePointsDetail).reduce((sum, p) => sum + p, 0);
          const visitScore = allPlayers[playerIndex].visitScore || 0;
          allPlayers[playerIndex].gamePoints = totalGamePoints;
          allPlayers[playerIndex].combinedScore = calculateCombinedScore(visitScore, totalGamePoints);
          
          localStorage.setItem('allPlayers', JSON.stringify(allPlayers));
          setPlayers(allPlayers);
          
          if (playerUsername === username) {
            const updatedGamePoints = allPlayers[playerIndex].gamePointsDetail;
            setGamePoints(updatedGamePoints);
            localStorage.setItem('gamePoints', JSON.stringify(updatedGamePoints));
          }
          
          return true;
        }
        return false;
      };

      const getLeaderboard = () => {
        return [...players].sort((a, b) => b.combinedScore - a.combinedScore);
      };

      // Effects
      useEffect(() => {
        const loadPlayers = () => {
          const allPlayers = JSON.parse(localStorage.getItem('allPlayers') || '[]');
          setPlayers(allPlayers);
        };
        
        loadPlayers();
        const interval = setInterval(loadPlayers, 5000);
        return () => clearInterval(interval);
      }, []);

      useEffect(() => {
        if (username) updatePlayersList();
      }, [visitedStalls, gamePoints]);

      useEffect(() => {
        if (view !== 'scanner') stopScanner();
      }, [view]);

      useEffect(() => {
        lucide.createIcons();
      });

      return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50" },
        // Header
        React.createElement('div', { className: "bg-gradient-to-r from-amber-600 to-orange-600 text-white p-6 shadow-lg" },
          React.createElement('div', { className: "max-w-4xl mx-auto flex items-center justify-between" },
            React.createElement('div', { className: "flex items-center gap-3" },
              React.createElement(Icon, { name: "sparkles", className: "w-8 h-8" }),
              React.createElement('div', null,
                React.createElement('h1', { className: "text-2xl font-bold" }, 'Divine Games Festival'),
                React.createElement('p', { className: "text-amber-100 text-sm" }, 'Journey through the Five Realms')
              )
            ),
            username && React.createElement('div', { className: "text-right" },
              React.createElement('div', { className: "text-amber-100 text-sm" }, 'Playing as'),
              React.createElement('div', { className: "font-bold text-lg" }, username)
            )
          )
        ),

        // Navigation
        React.createElement('div', { className: "bg-white border-b border-amber-200 sticky top-0 z-10 shadow-sm" },
          React.createElement('div', { className: "max-w-4xl mx-auto flex" },
            ['home', 'scanner', 'leaderboard', 'admin'].map(tab =>
              React.createElement('button', {
                key: tab,
                onClick: () => tab === 'scanner' ? openScanner() : setView(tab),
                className: `flex-1 py-4 flex items-center justify-center gap-2 transition-all ${
                  view === tab ? 'bg-amber-100 text-amber-700 border-b-2 border-amber-600' : 'text-gray-600 hover:bg-amber-50'
                }`
              },
                React.createElement(Icon, { 
                  name: tab === 'home' ? 'star' : tab === 'scanner' ? 'camera' : tab === 'leaderboard' ? 'trophy' : 'users',
                  className: "w-5 h-5"
                }),
                React.createElement('span', { className: "font-medium" }, 
                  tab.charAt(0).toUpperCase() + tab.slice(1)
                )
              )
            )
          )
        ),

        // Success Modal
        showSuccessModal && scannedStallInfo && React.createElement('div', {
          className: "fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        },
          React.createElement('div', { className: "bg-white rounded-2xl p-8 max-w-md w-full text-center animate-bounce" },
            React.createElement('div', { className: "text-6xl mb-4" }, 'üéâ'),
            React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-2" }, 'Realm Discovered!'),
            React.createElement('div', { className: `text-xl font-bold bg-gradient-to-r ${scannedStallInfo.color} bg-clip-text text-transparent mb-4` },
              scannedStallInfo.name
            ),
            React.createElement('div', { className: "text-3xl font-bold text-amber-600 mb-2" }, '+20%'),
            React.createElement('p', { className: "text-gray-600" }, 'Added to your spiritual journey')
          )
        ),

        // Main Content
        React.createElement('div', { className: "max-w-4xl mx-auto p-6 pb-20" },
          view === 'home' && renderHomeView(),
          view === 'scanner' && renderScannerView(),
          view === 'leaderboard' && renderLeaderboardView(),
          view === 'admin' && renderAdminView()
        ),

        // Footer
        React.createElement('div', { className: "mt-12 pb-6 text-center text-gray-500 text-sm" },
          React.createElement('p', null, 'May your journey be blessed with wisdom and joy'),
          React.createElement('p', { className: "text-xs mt-2" }, 'üïâÔ∏è Divine Games Festival 2025 üïâÔ∏è')
        )
      );

      function renderHomeView() {
        return React.createElement('div', { className: "space-y-6" },
          // Welcome or Score Card
          !username ? React.createElement('div', { className: "bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-2xl p-6 shadow-lg" },
            React.createElement('h2', { className: "text-2xl font-bold mb-2" }, 'üôè Welcome, Seeker!'),
            React.createElement('p', { className: "mb-4" }, 'Begin your spiritual journey by scanning your first stall QR code.'),
            React.createElement('button', {
              onClick: openScanner,
              className: "bg-white text-amber-600 px-6 py-3 rounded-xl font-bold hover:scale-105 transition-all"
            }, 'Start Your Journey')
          ) : React.createElement('div', { className: "bg-white rounded-2xl shadow-lg p-6 border-2 border-amber-200" },
            React.createElement('div', { className: "text-center mb-6" },
              React.createElement('div', { className: "text-6xl font-bold bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent" },
                getCurrentScore() + '%'
              ),
              React.createElement('div', { className: "text-gray-600 mt-2" }, 'Your Spiritual Score')
            ),
            getCurrentReward() && React.createElement('div', { className: "bg-gradient-to-r from-amber-100 to-orange-100 rounded-xl p-4 text-center" },
              React.createElement('div', { className: "text-4xl mb-2" }, getCurrentReward().icon),
              React.createElement('div', { className: "text-xl font-bold text-amber-800" }, getCurrentReward().name),
              React.createElement('div', { className: "text-amber-700 text-sm mt-1" }, getCurrentReward().message)
            ),
            React.createElement('div', { className: "mt-6 grid grid-cols-2 gap-4 text-center" },
              React.createElement('div', { className: "bg-amber-50 rounded-lg p-4" },
                React.createElement('div', { className: "text-2xl font-bold text-amber-700" }, calculateVisitScore(visitedStalls) + '%'),
                React.createElement('div', { className: "text-xs text-gray-600 mt-1" }, 'Visit Score')
              ),
              React.createElement('div', { className: "bg-orange-50 rounded-lg p-4" },
                React.createElement('div', { className: "text-2xl font-bold text-orange-700" }, calculateGamePoints(gamePoints)),
                React.createElement('div', { className: "text-xs text-gray-600 mt-1" }, 'Game Points')
              )
            )
          ),

          // Stalls Progress
          React.createElement('div', { className: "bg-white rounded-2xl shadow-lg p-6 border-2 border-amber-200" },
            React.createElement('h2', { className: "text-xl font-bold text-gray-800 mb-4 flex items-center gap-2" },
              React.createElement(Icon, { name: "sparkles", className: "w-6 h-6 text-amber-600" }),
              'The Five Realms'
            ),
            React.createElement('div', { className: "space-y-3" },
              STALLS.map((stall, index) => {
                const isVisited = visitedStalls.includes(stall.id);
                const stallGamePoints = gamePoints[stall.id] || 0;
                return React.createElement('div', {
                  key: stall.id,
                  className: `p-4 rounded-xl border-2 transition-all ${
                    isVisited ? 'bg-gradient-to-r ' + stall.color + ' text-white border-transparent' : 'bg-gray-50 border-gray-200'
                  }`
                },
                  React.createElement('div', { className: "flex items-center justify-between" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                      React.createElement(Icon, { 
                        name: isVisited ? "check-circle" : "circle",
                        className: isVisited ? "w-6 h-6" : "w-6 h-6 text-gray-400"
                      }),
                      React.createElement('div', null,
                        React.createElement('div', { className: "font-bold" }, stall.name),
                        React.createElement('div', { className: `text-sm ${isVisited ? 'text-white/80' : 'text-gray-500'}` },
                          'Realm ' + (index + 1)
                        )
                      )
                    ),
                    React.createElement('div', { className: "text-right" },
                      isVisited ? React.createElement(React.Fragment, null,
                        React.createElement('div', { className: "text-2xl font-bold" }, '+20%'),
                        stallGamePoints > 0 && React.createElement('div', { className: "text-sm opacity-90" }, '+' + stallGamePoints + ' pts')
                      ) : React.createElement('div', { className: "text-gray-400 text-sm" }, 'Not visited')
                    )
                  )
                );
              })
            ),
            visitedStalls.length < 5 && React.createElement('button', {
              onClick: openScanner,
              className: "w-full mt-4 bg-gradient-to-r from-amber-600 to-orange-600 text-white py-3 rounded-xl font-bold hover:scale-105 transition-all"
            }, 'Scan Next Stall')
          ),

          // Rewards Track
          React.createElement('div', { className: "bg-white rounded-2xl shadow-lg p-6 border-2 border-amber-200" },
            React.createElement('h2', { className: "text-xl font-bold text-gray-800 mb-4 flex items-center gap-2" },
              React.createElement(Icon, { name: "award", className: "w-6 h-6 text-amber-600" }),
              'Rewards Path'
            ),
            React.createElement('div', { className: "space-y-2" },
              REWARDS.map(reward => {
                const visitScore = calculateVisitScore(visitedStalls);
                const isUnlocked = visitScore >= reward.threshold;
                return React.createElement('div', {
                  key: reward.threshold,
                  className: `p-3 rounded-lg flex items-center justify-between ${
                    isUnlocked ? 'bg-gradient-to-r from-amber-100 to-orange-100' : 'bg-gray-50'
                  }`
                },
                  React.createElement('div', { className: "flex items-center gap-3" },
                    React.createElement('div', { className: "text-2xl" }, reward.icon),
                    React.createElement('div', null,
                      React.createElement('div', { className: `font-bold ${isUnlocked ? 'text-amber-800' : 'text-gray-600'}` },
                        reward.name
                      ),
                      React.createElement('div', { className: `text-sm ${isUnlocked ? 'text-amber-700' : 'text-gray-500'}` },
                        reward.message
                      )
                    )
                  ),
                  React.createElement('div', { className: `font-bold ${isUnlocked ? 'text-amber-700' : 'text-gray-400'}` },
                    reward.threshold + '%'
                  )
                );
              })
            )
          )
        );
      }

      function renderScannerView() {
        return React.createElement('div', { className: "space-y-6" },
          React.createElement('div', { className: "bg-white rounded-2xl shadow-lg p-6 border-2 border-amber-200" },
            React.createElement('div', { className: "flex justify-between items-center mb-4" },
              React.createElement('h2', { className: "text-2xl font-bold text-gray-800" }, 'Scan Stall QR Code'),
              showScanner && React.createElement('button', {
                onClick: () => { stopScanner(); setView('home'); },
                className: "text-gray-600 hover:text-gray-800"
              },
                React.createElement(Icon, { name: "x", className: "w-6 h-6" })
              )
            ),

            cameraError ? React.createElement('div', { className: "text-center p-8" },
              React.createElement(Icon, { name: "alert-circle", className: "w-16 h-16 text-red-500 mx-auto mb-4" }),
              React.createElement('p', { className: "text-red-600 mb-4" }, cameraError),
              React.createElement('button', {
                onClick: startScanner,
                className: "bg-gradient-to-r from-amber-600 to-orange-600 text-white px-6 py-3 rounded-xl font-bold hover:scale-105 transition-all"
              }, 'Try Again')
            ) : !showScanner ? React.createElement('div', { className: "text-center" },
              React.createElement('div', { className: "w-64 h-64 mx-auto bg-gradient-to-br from-amber-100 to-orange-100 rounded-2xl flex items-center justify-center border-4 border-dashed border-amber-400 mb-6" },
                React.createElement(Icon, { name: "camera", className: "w-24 h-24 text-amber-600" })
              ),
              React.createElement('p', { className: "text-gray-600 mb-6" }, 'Position the QR code within the frame to scan'),
              React.createElement('button', {
                onClick: startScanner,
                className: "bg-gradient-to-r from-amber-600 to-orange-600 text-white px-8 py-4 rounded-xl font-bold hover:scale-105 transition-all text-lg inline-flex items-center gap-2"
              },
                React.createElement(Icon, { name: "camera", className: "w-6 h-6" }),
                'Open Camera'
              )
            ) : React.createElement('div', { className: "relative" },
              React.createElement('div', { id: "qr-reader", className: "overflow-hidden rounded-xl" }),
              scanCooldown && React.createElement('div', {
                className: "absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-75 text-white px-4 py-2 rounded-lg text-sm z-10"
              }, '‚ú® Processing scan...')
            ),

            React.createElement('div', { className: "mt-6 p-4 bg-amber-50 rounded-xl" },
              React.createElement('h3', { className: "font-bold text-amber-800 mb-2" }, 'üì± How to Scan:'),
              React.createElement('ol', { className: "text-sm text-amber-700 space-y-1" },
                React.createElement('li', null, '1. Allow camera permissions when prompted'),
                React.createElement('li', null, '2. Point your camera at the stall\'s QR code'),
                React.createElement('li', null, '3. Hold steady until the scan completes'),
                React.createElement('li', null, '4. Get your +20% reward instantly!')
              )
            ),

            React.createElement('div', { className: "mt-4 p-4 bg-blue-50 border-2 border-blue-200 rounded-xl" },
              React.createElement('h3', { className: "font-bold text-blue-800 mb-2" }, 'üí° Testing Locally?'),
              React.createElement('p', { className: "text-sm text-blue-700 mb-3" },
                'Camera requires HTTPS. Use demo buttons below for local testing, or deploy to enable camera.'
              ),
              React.createElement('p', { className: "text-sm font-bold text-blue-800 mb-2" }, 'Demo Mode: Click to simulate scanning'),
              React.createElement('div', { className: "space-y-2" },
                STALLS.map(stall =>
                  React.createElement('button', {
                    key: stall.id,
                    onClick: () => handleQRScan(stall.qrCode),
                    disabled: visitedStalls.includes(stall.id),
                    className: `w-full py-2 px-4 rounded-lg font-bold text-sm transition-all ${
                      visitedStalls.includes(stall.id)
                        ? 'bg-gray-200 text-gray-500 cursor-not-allowed'
                        : 'bg-gradient-to-r ' + stall.color + ' text-white hover:scale-105'
                    }`
                  },
                    visitedStalls.includes(stall.id) ? '‚úì Already Visited' : `Demo: ${stall.name}`
                  )
                )
              )
            )
          )
        );
      }

      function renderLeaderboardView() {
        const leaderboard = getLeaderboard();
        return React.createElement('div', { className: "space-y-6" },
          React.createElement('div', { className: "bg-white rounded-2xl shadow-lg p-6 border-2 border-amber-200" },
            React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center flex items-center justify-center gap-2" },
              React.createElement(Icon, { name: "trophy", className: "w-8 h-8 text-amber-600" }),
              'Live Leaderboard'
            ),

            leaderboard.length === 0 ? React.createElement('div', { className: "text-center text-gray-500 py-12" },
              React.createElement(Icon, { name: "users", className: "w-16 h-16 mx-auto mb-4 text-gray-300" }),
              React.createElement('p', null, 'No players yet. Start your journey!')
            ) : React.createElement('div', { className: "space-y-3" },
              leaderboard.map((player, index) =>
                React.createElement('div', {
                  key: player.username,
                  className: `p-4 rounded-xl border-2 transition-all ${
                    player.username === username ? 'bg-gradient-to-r from-amber-100 to-orange-100 border-amber-400' :
                    index === 0 ? 'bg-gradient-to-r from-yellow-100 to-amber-100 border-yellow-400' :
                    'bg-gray-50 border-gray-200'
                  }`
                },
                  React.createElement('div', { className: "flex items-center justify-between" },
                    React.createElement('div', { className: "flex items-center gap-4" },
                      React.createElement('div', { className: `text-2xl font-bold ${
                        index === 0 ? 'text-yellow-600' :
                        index === 1 ? 'text-gray-400' :
                        index === 2 ? 'text-amber-700' :
                        'text-gray-500'
                      }` },
                        index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`
                      ),
                      React.createElement('div', null,
                        React.createElement('div', { className: "font-bold text-gray-800 flex items-center gap-2" },
                          player.username,
                          player.username === username && React.createElement('span', {
                            className: "text-xs bg-amber-600 text-white px-2 py-1 rounded-full"
                          }, 'You')
                        ),
                        React.createElement('div', { className: "text-sm text-gray-600" },
                          `Visit: ${player.visitScore}% ‚Ä¢ Games: ${player.gamePoints}pts`
                        )
                      )
                    ),
                    React.createElement('div', { className: "text-right" },
                      React.createElement('div', { className: "text-3xl font-bold bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent" },
                        player.combinedScore + '%'
                      )
                    )
                  )
                )
              )
            ),

            React.createElement('div', { className: "mt-6 text-center text-sm text-gray-500" },
              React.createElement('p', null, 'üîÑ Leaderboard updates every 5 seconds')
            )
          )
        );
      }

      function renderAdminView() {
        return React.createElement('div', { className: "space-y-6" },
          !isAdmin ? React.createElement('div', { className: "bg-white rounded-2xl shadow-lg p-6 border-2 border-amber-200" },
            React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center" }, 'Admin Access'),
            React.createElement('div', { className: "max-w-sm mx-auto" },
              React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, 'Enter Admin PIN'),
              React.createElement('input', {
                type: "password",
                value: adminPin,
                onChange: (e) => setAdminPin(e.target.value),
                placeholder: "Enter PIN",
                className: "w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-amber-500",
                onKeyPress: (e) => {
                  if (e.key === 'Enter' && adminPin === '1234') setIsAdmin(true);
                }
              }),
              React.createElement('button', {
                onClick: () => {
                  if (adminPin === '1234') {
                    setIsAdmin(true);
                  } else {
                    alert('Incorrect PIN');
                  }
                },
                className: "w-full mt-4 bg-gradient-to-r from-amber-600 to-orange-600 text-white py-3 rounded-xl font-bold hover:scale-105 transition-all"
              }, 'Access Admin Panel'),
              React.createElement('p', { className: "text-xs text-gray-500 text-center mt-4" }, 'Contact your event organizer for the PIN')
            )
          ) : React.createElement('div', { className: "bg-white rounded-2xl shadow-lg p-6 border-2 border-amber-200" },
            React.createElement('div', { className: "flex justify-between items-center mb-6" },
              React.createElement('h2', { className: "text-2xl font-bold text-gray-800" }, 'Admin Panel'),
              React.createElement('button', {
                onClick: () => { setIsAdmin(false); setAdminPin(''); },
                className: "text-sm text-gray-600 hover:text-gray-800 px-4 py-2 bg-gray-100 rounded-lg"
              }, 'Logout')
            ),

            React.createElement('div', { className: "mb-6" },
              React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, 'Select Your Stall'),
              React.createElement('select', {
                value: selectedStall || '',
                onChange: (e) => setSelectedStall(e.target.value),
                className: "w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-amber-500"
              },
                React.createElement('option', { value: "" }, 'Choose a stall...'),
                STALLS.map(stall =>
                  React.createElement('option', { key: stall.id, value: stall.id }, stall.name)
                )
              )
            ),

            selectedStall && React.createElement('div', { className: "space-y-4" },
              React.createElement('h3', { className: "font-bold text-gray-800 flex items-center gap-2" },
                React.createElement(Icon, { name: "users", className: "w-5 h-5 text-amber-600" }),
                `Players at ${STALLS.find(s => s.id === selectedStall)?.name}`
              ),
              
              players.filter(p => p.visitedStalls?.includes(selectedStall)).length === 0 ?
                React.createElement('div', { className: "text-center text-gray-500 py-8" },
                  React.createElement('p', null, 'No players have visited this stall yet.')
                ) :
                players.filter(p => p.visitedStalls?.includes(selectedStall)).map(player =>
                  React.createElement('div', {
                    key: player.username,
                    className: "p-4 bg-gray-50 rounded-xl border-2 border-gray-200"
                  },
                    React.createElement('div', { className: "flex justify-between items-center mb-3" },
                      React.createElement('div', null,
                        React.createElement('div', { className: "font-bold text-gray-800" }, player.username),
                        React.createElement('div', { className: "text-sm text-gray-600" },
                          `Current points: ${player.gamePointsDetail?.[selectedStall] || 0} / 100`
                        )
                      )
                    ),
                    React.createElement('div', { className: "flex gap-2" },
                      React.createElement('input', {
                        type: "number",
                        id: `points-${player.username}`,
                        placeholder: "Enter points (0-100)",
                        min: "0",
                        max: "100",
                        defaultValue: player.gamePointsDetail?.[selectedStall] || '',
                        className: "flex-1 px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-amber-500"
                      }),
                      React.createElement('button', {
                        onClick: () => {
                          const input = document.getElementById(`points-${player.username}`);
                          const points = parseInt(input.value) || 0;
                          if (points >= 0 && points <= 100) {
                            addGamePoints(player.username, selectedStall, points);
                            alert(`‚úÖ ${points} points awarded to ${player.username}`);
                          } else {
                            alert('Please enter points between 0 and 100');
                          }
                        },
                        className: "px-6 py-2 bg-gradient-to-r from-amber-600 to-orange-600 text-white rounded-lg font-bold hover:scale-105 transition-all"
                      }, 'Award')
                    )
                  )
                ),

              React.createElement('div', { className: "mt-6 p-4 bg-amber-50 rounded-xl" },
                React.createElement('h4', { className: "font-bold text-amber-800 mb-2" }, 'üìä Admin Guidelines:'),
                React.createElement('ul', { className: "text-sm text-amber-700 space-y-1" },
                  React.createElement('li', null, '‚Ä¢ Award 0-100 points based on game performance'),
                  React.createElement('li', null, '‚Ä¢ Points can be updated multiple times'),
                  React.createElement('li', null, '‚Ä¢ Higher scores improve leaderboard ranking'),
                  React.createElement('li', null, '‚Ä¢ Be fair and consistent in scoring')
                )
              )
            )
          )
        );
      }
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(SpiritualGamesApp));
  </script>
</body>
</html>