<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Seva Mela - VCD Department">
  <meta name="theme-color" content="#f97316">
  <title>Seva Mela - VCD Department</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding-bottom: 80px;
      background: #f8f9fa;
    }

    /* Splash Screen */
    .splash-screen {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: linear-gradient(135deg, #f97316 0%, #fb923c 50%, #1e3a8a 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .splash-logo {
      width: 150px;
      height: 150px;
      margin-bottom: 2rem;
      border-radius: 50%;
      object-fit: contain;
      background: white;
      padding: 15px;
      animation: logoFloat 3s ease-in-out infinite;
      filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.4));
    }

    @keyframes logoFloat {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-20px) scale(1.05); }
    }

    .splash-content {
      text-align: center;
      position: relative;
      animation: fadeInUp 1s ease-out;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .spiritual-path {
      position: relative;
      width: 400px;
      height: 200px;
      margin: 40px auto;
      max-width: 90vw;
    }

    .path-line {
      position: absolute;
      bottom: 60px;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 2px;
      overflow: hidden;
    }

    .path-line::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .monkey-walker {
      position: absolute;
      bottom: 45px;
      left: 0;
      font-size: 60px;
      animation: walkPath 4s ease-in-out infinite;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
    }

    @keyframes walkPath {
      0%, 100% { left: 0; transform: translateX(0) scaleX(1); }
      48% { transform: translateX(0) scaleX(1); }
      50% { transform: translateX(0) scaleX(-1); }
      98%, 100% { left: calc(100% - 60px); transform: translateX(0) scaleX(-1); }
    }

    .breathing-circle {
      position: absolute;
      bottom: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 30px;
      border: 3px solid rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.4; }
      50% { transform: translateX(-50%) scale(1.5); opacity: 0.8; }
    }

    .floating-elements {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
    }

    .floating-particle {
      position: absolute;
      font-size: 24px;
      opacity: 0;
      animation: float 6s ease-in-out infinite;
    }

    .floating-particle:nth-child(1) { left: 10%; animation-delay: 0s; }
    .floating-particle:nth-child(2) { left: 20%; animation-delay: 1s; }
    .floating-particle:nth-child(3) { left: 30%; animation-delay: 2s; }
    .floating-particle:nth-child(4) { left: 40%; animation-delay: 0.5s; }
    .floating-particle:nth-child(5) { left: 50%; animation-delay: 1.5s; }
    .floating-particle:nth-child(6) { left: 60%; animation-delay: 2.5s; }
    .floating-particle:nth-child(7) { left: 70%; animation-delay: 1s; }
    .floating-particle:nth-child(8) { left: 80%; animation-delay: 2s; }
    .floating-particle:nth-child(9) { left: 90%; animation-delay: 0.8s; }

    @keyframes float {
      0% { bottom: -50px; opacity: 0; transform: translateX(0) rotate(0deg); }
      10% { opacity: 0.7; }
      90% { opacity: 0.7; }
      100% { bottom: 100%; opacity: 0; transform: translateX(50px) rotate(360deg); }
    }

    .splash-title {
      color: white;
      font-size: 3rem;
      font-weight: 900;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      margin-bottom: 1rem;
      animation: textGlow 2s ease-in-out infinite;
    }

    @keyframes textGlow {
      0%, 100% { text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); }
      50% { text-shadow: 0 4px 40px rgba(255, 255, 255, 0.6); }
    }

    .splash-tagline {
      color: rgba(255, 255, 255, 0.9);
      font-size: 1.25rem;
      margin-top: 1rem;
      font-style: italic;
    }

    .loading-dots {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 2rem;
    }

    .loading-dots span {
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out;
    }

    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }

    .splash-hidden {
      animation: fadeOutDown 0.8s ease-in-out forwards;
    }

    @keyframes fadeOutDown {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(30px); }
    }

    /* Progress bar with candy stripes */
    .progress-bar-container {
      position: relative;
      height: 16px;
      background: #e5e7eb;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(
        45deg,
        #10b981 25%,
        #3b82f6 25%,
        #3b82f6 50%,
        #10b981 50%,
        #10b981 75%,
        #3b82f6 75%,
        #3b82f6
      );
      background-size: 40px 40px;
      animation: progressStripes 1s linear infinite;
      transition: width 0.5s ease-in-out;
      border-radius: 10px;
    }

    @keyframes progressStripes {
      from { background-position: 0 0; }
      to { background-position: 40px 0; }
    }

    /* Success Modal */
    .success-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10000;
      background: white;
      border-radius: 24px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.5s ease-out;
      max-width: 90vw;
      width: 400px;
    }

    @keyframes modalSlideIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }

    .success-checkmark {
      width: 80px;
      height: 80px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      background: #10b981;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: successBounce 0.6s ease-out;
    }

    @keyframes successBounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    /* Bottom Navigation - Game style */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #fff5f0 0%, #fef3e7 100%);
      border-top: 1px solid #e5e7eb;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
      z-index: 1000;
      padding: 0.5rem 0;
    }

    .nav-button {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      padding: 0.5rem;
      border: none;
      background: transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #6b7280;
    }

    .nav-button svg {
      display: block !important;
      width: 24px;
      height: 24px;
    }

    .nav-button.active {
      color: #f97316;
      background: rgba(249, 115, 22, 0.1);
      border-radius: 12px;
    }

    .nav-button:hover {
      color: #f97316;
      background: rgba(249, 115, 22, 0.05);
      border-radius: 12px;
    }

    .nav-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Modal backdrop */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9998;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Leaderboard slide-in */
    .leaderboard-slide {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 90%;
      max-width: 500px;
      background: white;
      z-index: 9999;
      overflow-y: auto;
      animation: slideInLeft 0.3s ease-out;
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
    }

    @keyframes slideInLeft {
      from { transform: translateX(-100%); }
      to { transform: translateX(0); }
    }

    #qr-reader {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
    }

    /* Game card styling */
    .game-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: row;
    }

    .game-card:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
      transform: translateY(-2px);
    }

    .game-card-image {
      width: 140px;
      min-height: 140px;
      max-height: 200px;
      object-fit: cover;
      object-position: center;
      flex-shrink: 0;
      background: #f9fafb;
      clip-path: inset(3% 0 3% 0);
    }

    @media (max-width: 768px) {
      .game-card-image {
        width: 120px;
        min-height: 120px;
        max-height: 180px;
      }
    }

    /* Score table */
    .score-table-container {
      overflow-x: auto;
      max-width: 100%;
      -webkit-overflow-scrolling: touch;
    }

    .score-table {
      width: 100%;
      min-width: 400px;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    .score-table th,
    .score-table td {
      padding: 0.5rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }

    @media (max-width: 768px) {
      .score-table {
        font-size: 0.75rem;
      }
      
      .score-table th,
      .score-table td {
        padding: 0.375rem;
      }
    }

    .score-table th {
      background: #f9fafb;
      font-weight: 700;
      color: #374151;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .score-table tr:hover {
      background: #f9fafb;
    }

    /* Stats badge */
    .stat-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: #f3f4f8;
      border-radius: 12px;
      font-size: 0.875rem;
    }

    .stat-value {
      font-weight: 700;
      font-size: 1.125rem;
    }

    /* Fun fair login background */
    .login-fun-fair {
      position: absolute;
      inset: 0;
      opacity: 0.15;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }

    .login-fun-fair > div {
      position: absolute;
      font-size: 3rem;
      animation: float-bounce 3s ease-in-out infinite;
    }

    @keyframes float-bounce {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10000;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: slideDown 0.3s ease-out;
      max-width: 90%;
      text-align: center;
    }

    .toast.success {
      background: #10b981;
      color: white;
    }

    .toast.error {
      background: #ef4444;
      color: white;
    }

    .toast.info {
      background: #3b82f6;
      color: white;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    /* Custom Modal/Dialog */
    .custom-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      animation: fadeIn 0.2s ease-out;
    }

    .custom-modal {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: scaleIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.75rem;
    }

    .modal-message {
      color: #6b7280;
      margin-bottom: 1.5rem;
      line-height: 1.5;
    }

    .modal-buttons {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
    }

    .modal-btn {
      padding: 0.625rem 1.25rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }

    .modal-btn-cancel {
      background: #f3f4f6;
      color: #374151;
    }

    .modal-btn-cancel:hover {
      background: #e5e7eb;
    }

    .modal-btn-confirm {
      background: #f97316;
      color: white;
    }

    .modal-btn-confirm:hover {
      background: #ea580c;
    }
    /* Done badge */
    .done-badge {
      display: inline-block;
      padding: 2px 8px;
      background: #10b981;
      color: white;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 700;
      margin-left: 6px;
    }

    /* Completed game card */
    .game-card.completed {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%) !important;
    }

    /* QR Code styling */
    #qrcode canvas {
      border: 4px solid #000 !important;
    }
    /* Score highlighting */
    .score-highlight {
      padding: 8px;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
      font-weight: 600;
    }
    
    .score-highlight.stage {
      background: #fed7aa;
      border-color: #f97316;
    }
    
    .score-highlight.game {
      background: #dbeafe;
      border-color: #3b82f6;
    }


  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash-screen" class="splash-screen">
    <div class="floating-elements">
      <div class="floating-particle">üå∏</div>
      <div class="floating-particle">‚ú®</div>
      <div class="floating-particle">ü™∑</div>
      <div class="floating-particle">üïâÔ∏è</div>
      <div class="floating-particle">üå∫</div>
      <div class="floating-particle">‚≠ê</div>
      <div class="floating-particle">üí´</div>
      <div class="floating-particle">‚ú®</div>
      <div class="floating-particle">üå∏</div>
    </div>

    <div class="splash-content">
      <img src="isha_symbol.jpg" alt="Isha Foundation" class="splash-logo" onerror="this.style.display='none'">
      
      <h1 class="splash-title">Seva Mela</h1>
      <p class="text-4xl text-white font-bold mb-4">VCD Department</p>
      
      <div class="spiritual-path">
        <div class="path-line"></div>
        <div class="monkey-walker">üêí</div>
        <div class="breathing-circle"></div>
        <div style="position: absolute; left: 10%; top: 20%; font-size: 40px; animation: float 3s ease-in-out infinite;">üêíüçå</div>
        <div style="position: absolute; right: 15%; top: 30%; font-size: 35px; animation: float 4s ease-in-out infinite; animation-delay: 1s;">üêµüçå</div>
        <div style="position: absolute; left: 20%; bottom: 20%; font-size: 45px; animation: float 3.5s ease-in-out infinite; animation-delay: 0.5s;">üêíüçå</div>
        <div style="position: absolute; right: 10%; bottom: 30%; font-size: 38px; animation: float 4.5s ease-in-out infinite; animation-delay: 1.5s;">üêµüçå</div>
      </div>

      <p class="splash-tagline">"Evolve from Monkey to Yogi"</p>
      
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <div id="root"></div>

  <script>
    const { useState, useEffect, useRef } = React;

    const GAMES = [
      { 
        id: 'game1', 
        name: 'Wheel of Fortune', 
        qrCode: 'GAME1_WHEEL_OF_FORTUNE',
        image: 'wheel_game.png',
        stageName: 'Seeker',
        stageSlogan: 'The first step is seeking the truth within',
        stagePoints: 10,
        gamePoints: 20,
        maxCoins: 100
      },
      { 
        id: 'game2', 
        name: 'Memory Card Quiz', 
        qrCode: 'GAME2_MEMORY_CARD_QUIZ',
        image: 'memory_card.png',
        stageName: 'Explorer',
        stageSlogan: 'Exploration leads to inner discovery',
        stagePoints: 10,
        gamePoints: 20,
        maxCoins: 100
      },
      { 
        id: 'game3', 
        name: 'Paper Plane', 
        qrCode: 'GAME3_PAPER_PLANE',
        image: 'paper_plane.png',
        stageName: 'Wanderer',
        stageSlogan: 'Wandering the path, finding your way home',
        stagePoints: 10,
        gamePoints: 15,
        maxCoins: 100
      },
      { 
        id: 'game4', 
        name: 'Volunteer Tree Experience', 
        qrCode: 'GAME4_VOLUNTEER_TREE',
        image: 'volunteer_tree.png',
        stageName: 'Yogi',
        stageSlogan: 'The Yogi serves, transforms, and transcends',
        stagePoints: 15,
        gamePoints: 0,
        maxCoins: 0
      }
    ];

    const CATEGORIES = [
      'Long Term Volunteer (LTV)',
      'Short Term Volunteer (STV)',
      'Brahmachari',
      'Sanyasi',
      'Sadhanapada',
      'Ashram Resident',
      'Visitor Guest',
      'Sevadhar',
      'Staff',
      'Admin'
    ];

    const ADMIN_PIN = '1234';

    function Icon({ name, size = 24, className = "" }) {
      const iconRef = useRef(null);
      
      useEffect(() => {
        if (iconRef.current && window.lucide) {
          iconRef.current.innerHTML = '';
          iconRef.current.setAttribute('data-lucide', name);
          window.lucide.createIcons();
        }
      }, [name]);
      
      return React.createElement('i', { 
        ref: iconRef, 
        'data-lucide': name,
        style: { width: size + 'px', height: size + 'px', display: 'inline-block' },
        className: className
      });
    }

    function SevaMelaApp() {
      const [showSplash, setShowSplash] = useState(true);
      const [onboardingComplete, setOnboardingComplete] = useState(false);
      const [userName, setUserName] = useState('');
      const [userCategory, setUserCategory] = useState('');
      const [isAdmin, setIsAdmin] = useState(false);
      const [adminPinInput, setAdminPinInput] = useState('');
      const [participants, setParticipants] = useState([]);
      const [currentUser, setCurrentUser] = useState(null);
      const [showLeaderboard, setShowLeaderboard] = useState(false);
      const [showQRScanner, setShowQRScanner] = useState(false);
      const [selectedGame, setSelectedGame] = useState(null);
      const [successModalData, setSuccessModalData] = useState(null);
      const [activeView, setActiveView] = useState('home');
      const [toast, setToast] = useState(null);
      const [modal, setModal] = useState(null);
      const [leaderboardSearch, setLeaderboardSearch] = useState('');
      const [adminSearchQuery, setAdminSearchQuery] = useState('');
      const [adminSortBy, setAdminSortBy] = useState('rank');
      const [leaderboardSortBy, setLeaderboardSortBy] = useState('rank');
      const [refreshing, setRefreshing] = useState(false);
      
      const html5QrCodeRef = useRef(null);
      const isScanning = useRef(false);

      const showToast = (message, type = 'success') => {
        setToast({ message, type });
        setTimeout(() => setToast(null), 3000);
      };

      const showModal = (title, message, onConfirm, confirmText = 'OK', showCancel = false) => {
        return new Promise((resolve) => {
          setModal({
            title,
            message,
            onConfirm: () => {
              if (onConfirm) onConfirm();
              setModal(null);
              resolve(true);
            },
            onCancel: () => {
              setModal(null);
              resolve(false);
            },
            confirmText,
            showCancel
          });
        });
      };

      
      const refreshScores = () => {
        setRefreshing(true);
        const savedParticipants = localStorage.getItem('sevaMelaParticipants');
        if (savedParticipants) {
          const parsed = JSON.parse(savedParticipants);
          setParticipants(parsed);
          if (currentUser) {
            const updated = parsed.find(p => p.name === currentUser.name && p.category === currentUser.category);
            if (updated) setCurrentUser(updated);
          }
        }
        showToast('Scores refreshed!', 'success');
        setTimeout(() => setRefreshing(false), 500);
      };

      const showConfirm = (title, message) => {
        return new Promise((resolve) => {
          setModal({
            title,
            message,
            onConfirm: () => {
              setModal(null);
              resolve(true);
            },
            onCancel: () => {
              setModal(null);
              resolve(false);
            },
            confirmText: 'Yes',
            showCancel: true
          });
        });
      };

      useEffect(() => {
        const savedParticipants = localStorage.getItem('sevaMelaParticipants');
        const savedUser = localStorage.getItem('sevaMelaCurrentUser');
        
        if (savedParticipants) {
          setParticipants(JSON.parse(savedParticipants));
        }
        
        if (savedUser) {
          const user = JSON.parse(savedUser);
          setCurrentUser(user);
          setUserName(user.name);
          setUserCategory(user.category);
          setIsAdmin(user.isAdmin);
          setOnboardingComplete(true);
        }
      }, []);

      useEffect(() => {
        if (participants.length > 0) {
          localStorage.setItem('sevaMelaParticipants', JSON.stringify(participants));
        }
      }, [participants]);

      useEffect(() => {
        if (currentUser) {
          localStorage.setItem('sevaMelaCurrentUser', JSON.stringify(currentUser));
        }
      }, [currentUser]);

      useEffect(() => {
        const confettiTimer = setTimeout(() => {
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
          });
        }, 500);
        
        const timer = setTimeout(() => {
          const splash = document.getElementById('splash-screen');
          if (splash) {
            splash.classList.add('splash-hidden');
            setTimeout(() => {
              splash.style.display = 'none';
              setShowSplash(false);
            }, 800);
          }
        }, 3000);
        
        return () => {
          clearTimeout(confettiTimer);
          clearTimeout(timer);
        };
      }, []);

      const handleOnboardingSubmit = () => {
        if (userCategory === 'Admin') {
          if (adminPinInput !== ADMIN_PIN) {
            showToast('Incorrect PIN', 'error');
            return;
          }
          
          const adminUser = {
            name: 'Admin',
            category: 'Admin',
            isAdmin: true,
            games: GAMES.reduce((acc, game) => ({
              ...acc,
              [game.id]: {
                scanned: false,
                stagePercent: 0,
                coinsEarned: 0,
                gamePercent: 0
              }
            }), {})
          };
          
          setCurrentUser(adminUser);
          setUserName('Admin');
          setIsAdmin(true);
          setOnboardingComplete(true);
          return;
        }

        if (!userName.trim() || !userCategory) {
          showToast('Enter name & category', 'error');
          return;
        }

        const trimmedName = userName.trim();
        const existingUser = participants.find(p => 
          p.name === trimmedName && p.category === userCategory
        );
        
        if (existingUser) {
          setCurrentUser(existingUser);
          setUserName(existingUser.name);
          setIsAdmin(existingUser.isAdmin);
          setOnboardingComplete(true);
          showToast(`Welcome back, ${trimmedName}!`, 'info');
          return;
        }
        
        const nameExistsElsewhere = participants.find(p => 
          p.name.toLowerCase() === trimmedName.toLowerCase() && p.category !== userCategory
        );
        
        if (nameExistsElsewhere) {
          const result = confirm(
            `Note: "${trimmedName}" is already used by someone in ${nameExistsElsewhere.category} category.\n\n` +
            `You can still use "${trimmedName}" for ${userCategory} category.\n\n` +
            `Click OK to continue with "${trimmedName}"\n` +
            `Click Cancel to choose a different name`
          );
          
          if (result) {
            createNewUser(trimmedName);
          }
          return;
        }
        
        const similarNames = participants.filter(p => 
          p.category === userCategory && (
            p.name.toLowerCase() === trimmedName.toLowerCase() ||
            p.name.toLowerCase().startsWith(trimmedName.toLowerCase() + ' ')
          )
        );
        
        if (similarNames.length > 0) {
          let counter = 1;
          let suggestedName = `${trimmedName} ${counter}`;
          while (participants.find(p => p.name === suggestedName && p.category === userCategory)) {
            counter++;
            suggestedName = `${trimmedName} ${counter}`;
          }
          
          const result = confirm(
            `The name "${trimmedName}" or similar is already taken in ${userCategory} category.\n\n` +
            `Existing: ${similarNames.map(p => p.name).join(', ')}\n\n` +
            `Would you like to use "${suggestedName}" instead?\n\n` +
            `Click OK to use "${suggestedName}"\n` +
            `Click Cancel to choose a different name`
          );
          
          if (result) {
            createNewUser(suggestedName);
          }
          return;
        }
        
        createNewUser(trimmedName);
      };

      const createNewUser = (finalName) => {
        const newUser = {
          name: finalName,
          category: userCategory,
          isAdmin: false,
          games: GAMES.reduce((acc, game) => ({
            ...acc,
            [game.id]: {
              scanned: false,
              stagePercent: 0,
              coinsEarned: 0,
              gamePercent: 0
            }
          }), {})
        };

        const updatedParticipants = [...participants, newUser];
        setParticipants(updatedParticipants);
        setCurrentUser(newUser);
        setUserName(finalName);
        setIsAdmin(false);
        setOnboardingComplete(true);
      };

      const calculateProgress = () => {
        if (!currentUser || isAdmin) return 0;
        
        let totalPercent = 0;
        GAMES.forEach(game => {
          const gameData = currentUser.games[game.id];
          if (gameData) {
            totalPercent += (gameData.stagePercent || 0) + (gameData.gamePercent || 0);
          }
        });
        
        return Math.min(100, Math.round(totalPercent));
      };

      const handleQRScan = (decodedText) => {
        console.log('QR Scanned:', decodedText);
        
        if (isAdmin) {
          alert('Admin users cannot scan QR codes');
          return;
        }

        const matchedGame = GAMES.find(g => decodedText.includes(g.qrCode) || decodedText.includes(g.id));
        
        if (matchedGame) {
          if (html5QrCodeRef.current && isScanning.current) {
            html5QrCodeRef.current.stop().then(() => {
              isScanning.current = false;
              setShowQRScanner(false);
            }).catch(err => console.error(err));
          } else {
            setShowQRScanner(false);
          }

          const currentGameData = currentUser.games[matchedGame.id];
          if (currentGameData.scanned) {
            showToast('Already scanned', 'info');
            return;
          }

          const updatedUser = {
            ...currentUser,
            games: {
              ...currentUser.games,
              [matchedGame.id]: {
                ...currentGameData,
                scanned: true,
                stagePercent: matchedGame.stagePoints
              }
            }
          };

          setCurrentUser(updatedUser);
          
          const updatedParticipants = participants.map(p => 
            p.name === currentUser.name && p.category === currentUser.category ? updatedUser : p
          );
          setParticipants(updatedParticipants);

          const scannedCount = Object.values(updatedUser.games).filter(g => g.scanned).length;
          let totalPercent = 0;
          GAMES.forEach(game => {
            const gData = updatedUser.games[game.id];
            totalPercent += (gData.stagePercent || 0) + (gData.gamePercent || 0);
          });

          setSuccessModalData({
            game: matchedGame,
            scannedCount,
            totalProgress: Math.min(100, Math.round(totalPercent))
          });

          confetti({
            particleCount: 200,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#f97316', '#fb923c', '#1e3a8a', '#3b82f6', '#10b981']
          });

          setTimeout(() => {
            setSuccessModalData(null);
          }, 2500);
        } else {
          showToast('Invalid QR code', 'error');
        }
      };

      const startQRScanner = () => {
        setShowQRScanner(true);
        
        setTimeout(() => {
          const qrReaderElement = document.getElementById('qr-reader');
          if (!qrReaderElement) {
            console.error('QR reader element not found');
            return;
          }

          if (!html5QrCodeRef.current) {
            html5QrCodeRef.current = new Html5Qrcode("qr-reader");
          }

          if (!isScanning.current) {
            html5QrCodeRef.current.start(
              { facingMode: "environment" },
              {
                fps: 10,
                qrbox: { width: 250, height: 250 }
              },
              handleQRScan,
              (errorMessage) => {}
            ).then(() => {
              isScanning.current = true;
            }).catch(err => {
              console.error('Camera start error:', err);
              alert('Camera permission denied or not available. Please check settings.');
            });
          }
        }, 100);
      };

      const stopQRScanner = () => {
        if (html5QrCodeRef.current && isScanning.current) {
          html5QrCodeRef.current.stop().then(() => {
            isScanning.current = false;
            setShowQRScanner(false);
          }).catch(err => console.error(err));
        } else {
          setShowQRScanner(false);
        }
      };

      const awardGamePoints = (participantName, participantCategory, gameId, coins) => {
        const game = GAMES.find(g => g.id === gameId);
        
        if (coins < 0 || coins > game.maxCoins) {
          alert(`Coins must be between 0 and ${game.maxCoins}`);
          return false;
        }

        const gamePercent = game.maxCoins > 0 ? Math.round((coins / game.maxCoins) * game.gamePoints) : 0;

        const updatedParticipants = participants.map(p => {
          if (p.name === participantName && p.category === participantCategory) {
            return {
              ...p,
              games: {
                ...p.games,
                [gameId]: {
                  ...p.games[gameId],
                  coinsEarned: coins,
                  gamePercent: gamePercent
                }
              }
            };
          }
          return p;
        });

        setParticipants(updatedParticipants);
        
        confetti({
          particleCount: 150,
          spread: 70,
          origin: { y: 0.6 },
          colors: ['#f97316', '#fb923c', '#1e3a8a', '#3b82f6', '#10b981'],
          zIndex: 10002
        });

        if (currentUser && currentUser.name === participantName && currentUser.category === participantCategory) {
          const updatedUser = updatedParticipants.find(p => p.name === participantName && p.category === participantCategory);
          setCurrentUser(updatedUser);
        }

        return true;
      };

      const getLeaderboard = () => {
        const sorted = participants
          .filter(p => !p.isAdmin)
          .map(p => {
            let totalPercent = 0;
            GAMES.forEach(game => {
              const gameData = p.games[game.id];
              totalPercent += gameData.stagePercent + gameData.gamePercent;
            });
            
            return {
              name: p.name,
              category: p.category,
              totalPercentage: Math.min(100, Math.round(totalPercent))
            };
          })
          .sort((a, b) => b.totalPercentage - a.totalPercentage);
        
        let currentRank = 1;
        return sorted.map((player, index) => {
          if (index > 0 && sorted[index - 1].totalPercentage !== player.totalPercentage) {
            currentRank = index + 1;
          }
          return { ...player, rank: currentRank };
        });
      };

      const handleRefresh = () => {
        const savedParticipants = localStorage.getItem('sevaMelaParticipants');
        const savedUser = localStorage.getItem('sevaMelaCurrentUser');
        
        if (savedParticipants) {
          setParticipants(JSON.parse(savedParticipants));
        }
        
        if (savedUser) {
          setCurrentUser(JSON.parse(savedUser));
        }
        
        alert('Data refreshed!');
      };

      const deletePlayer = async (playerName, playerCategory) => {
        if (!isAdmin) {
          showToast('Admin only', 'error');
          return;
        }

        const result = await showConfirm('Delete Player', `Remove ${playerName} (${playerCategory})?`);
        if (result) {
          const updatedParticipants = participants.filter(
            p => !(p.name === playerName && p.category === playerCategory)
          );
          setParticipants(updatedParticipants);
          showToast('Player deleted', 'success');
        }
      };

      // CSV Export for data backup
      const exportDataAsCSV = () => {
        if (!isAdmin) {
          alert('Only admins can export data');
          return;
        }
        
        const headers = ['Name', 'Category', ...GAMES.map(g => g.name + '_Stage%'), ...GAMES.map(g => g.name + '_Game%'), ...GAMES.map(g => g.name + '_Coins'), 'Total%'];
        const rows = participants
          .filter(p => !p.isAdmin)
          .map(p => {
            const stageScores = GAMES.map(g => p.games[g.id]?.stagePercent || 0);
            const gameScores = GAMES.map(g => p.games[g.id]?.gamePercent || 0);
            const coins = GAMES.map(g => p.games[g.id]?.coinsEarned || 0);
            const total = [...stageScores, ...gameScores].reduce((a,b) => a+b, 0);
            return [p.name, p.category, ...stageScores, ...gameScores, ...coins, Math.min(100, Math.round(total))];
          });
        
        const csvContent = [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `seva-mela-backup-${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        URL.revokeObjectURL(url);
        showToast('‚úì Data exported', 'success');
      };

      // CSV Import to restore data
      const importDataFromCSV = (event) => {
        if (!isAdmin) {
          alert('Only admins can import data');
          return;
        }
        
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const text = e.target.result;
            const lines = text.split('\n').filter(line => line.trim());
            if (lines.length < 2) {
              alert('Invalid CSV file');
              return;
            }
            
            const restored = [];
            
            for (let i = 1; i < lines.length; i++) {
              const values = lines[i].split(',');
              if (values.length < 2) continue;
              
              const name = values[0].trim();
              const category = values[1].trim();
              
              const games = {};
              GAMES.forEach((game, idx) => {
                games[game.id] = {
                  scanned: values[2 + idx] > 0 || values[2 + GAMES.length + idx] > 0,
                  stagePercent: parseInt(values[2 + idx]) || 0,
                  gamePercent: parseInt(values[2 + GAMES.length + idx]) || 0,
                  coinsEarned: parseInt(values[2 + 2*GAMES.length + idx]) || 0
                };
              });
              
              restored.push({ name, category, isAdmin: false, games });
            }
            
            if (confirm(`Import ${restored.length} participants? This will replace current data.`)) {
              setParticipants([...participants.filter(p => p.isAdmin), ...restored]);
              showToast(`‚úì Imported ${restored.length} players`, 'success');
            }
          } catch (err) {
            showToast('Error importing', 'error');
          }
        };
        reader.readAsText(file);
      };

      
      const getFilteredAdminScores = () => {
        let filtered = getScoreTableData();
        
        // Apply search
        if (adminSearchQuery && adminSearchQuery.trim()) {
          const search = adminSearchQuery.toLowerCase();
          filtered = filtered.filter(p => 
            p.name.toLowerCase().includes(search) || 
            p.category.toLowerCase().includes(search)
          );
        }
        
        // Apply sort
        if (adminSortBy === 'name') {
          filtered.sort((a, b) => a.name.localeCompare(b.name));
        } else {
          // Sort by rank (total points descending)
          filtered.sort((a, b) => b.totalPoints - a.totalPoints);
        }
        
        return filtered;
      };

      const getScoreTableData = () => {
        return participants
          .filter(p => !p.isAdmin)
          .map(p => {
            const gameScores = GAMES.map(game => ({
              gameId: game.id,
              gameName: game.name,
              gamePercent: p.games[game.id]?.gamePercent || 0,
              stagePercent: p.games[game.id]?.stagePercent || 0,
              scanned: p.games[game.id]?.scanned || false
            }));
            
            const totalPoints = gameScores.reduce(
              (sum, g) => sum + g.gamePercent + g.stagePercent,
              0
            );

            return {
              ...p,
              gameScores,
              totalPoints: Math.min(100, Math.round(totalPoints))
            };
          })
          .sort((a, b) => b.totalPoints - a.totalPoints);
      };

      if (!onboardingComplete) {
        return React.createElement('div', { 
          className: "min-h-screen flex items-center justify-center p-6 bg-gradient-to-br from-orange-50 to-blue-50 relative overflow-hidden"
        },
          // Animated background emojis
          React.createElement('div', { className: "login-fun-fair" },
            React.createElement('div', { style: { top: '10%', left: '10%', animationDelay: '0s' } }, 'üé™'),
            React.createElement('div', { style: { top: '20%', right: '15%', fontSize: '2.5rem', animationDelay: '0.5s' } }, 'üé°'),
            React.createElement('div', { style: { bottom: '20%', left: '15%', fontSize: '2.5rem', animationDelay: '1s' } }, 'üé†'),
            React.createElement('div', { style: { bottom: '10%', right: '10%', fontSize: '3rem', animationDelay: '1.5s' } }, 'üé¢'),
            React.createElement('div', { style: { top: '50%', left: '25%', fontSize: '2rem', animationDelay: '0.3s' } }, 'üéØ'),
            React.createElement('div', { style: { top: '35%', right: '25%', fontSize: '2rem', animationDelay: '0.8s' } }, 'üéà')
          ),
          React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md border-2 border-orange-500 relative z-10" },
            React.createElement('div', { className: "text-center mb-8" },
              React.createElement('h2', { className: "text-3xl font-bold text-gray-800 mb-2" }, 'Seva Mela'),
              React.createElement('p', { className: "text-lg font-semibold text-orange-600" }, 'VCD Department')
            ),
            
            React.createElement('div', { className: "space-y-6" },
              userCategory !== 'Admin' && React.createElement('div', null,
                React.createElement('label', { className: "block text-sm font-bold text-gray-700 mb-2" }, 'Your Name'),
                React.createElement('input', {
                  type: "text",
                  value: userName,
                  onChange: (e) => setUserName(e.target.value),
                  placeholder: "Enter your name",
                  className: "w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 transition-all"
                }),
                userName.trim() && userCategory && (() => {
                  const trimmedName = userName.trim();
                  const exactMatch = participants.find(p => 
                    p.name === trimmedName && p.category === userCategory
                  );
                  const similarMatch = participants.find(p => 
                    p.category === userCategory && 
                    p.name.toLowerCase() !== trimmedName.toLowerCase() &&
                    p.name.toLowerCase().startsWith(trimmedName.toLowerCase())
                  );
                  
                  if (exactMatch) {
                    return React.createElement('div', { className: "mt-2 text-xs text-blue-600 bg-blue-50 px-3 py-2 rounded-lg" },
                      `‚úì This account already exists. Click "Start Journey" to continue.`
                    );
                  } else if (similarMatch) {
                    return React.createElement('div', { className: "mt-2 text-xs text-orange-600 bg-orange-50 px-3 py-2 rounded-lg" },
                      `‚ö† Similar name "${similarMatch.name}" exists. Consider using a different name.`
                    );
                  }
                  return null;
                })()
              ),

              React.createElement('div', null,
                React.createElement('label', { className: "block text-sm font-bold text-gray-700 mb-2" }, 'Category'),
                React.createElement('select', {
                  value: userCategory,
                  onChange: (e) => {
                    setUserCategory(e.target.value);
                    setAdminPinInput('');
                  },
                  className: "w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-orange-500 transition-all"
                },
                  React.createElement('option', { value: "" }, 'Select your category...'),
                  CATEGORIES.map(cat =>
                    React.createElement('option', { key: cat, value: cat }, cat)
                  )
                )
              ),

              userCategory === 'Admin' && React.createElement('div', { className: "bg-orange-50 border border-orange-200 rounded-xl p-4" },
                React.createElement('label', { className: "block text-xs font-semibold text-orange-700 mb-2 uppercase tracking-wide" }, 'Admin PIN'),
                React.createElement('input', {
                  type: "password",
                  value: adminPinInput,
                  onChange: (e) => setAdminPinInput(e.target.value),
                  placeholder: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢",
                  className: "w-full px-4 py-3 border border-orange-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                })
              ),

              React.createElement('button', {
                onClick: handleOnboardingSubmit,
                className: "w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-4 rounded-xl font-bold text-lg hover:scale-105 transition-all shadow-lg"
              }, 'Start Journey')
            )
          )
        );
      }

      const progress = calculateProgress();
      const leaderboard = getLeaderboard();
      const currentUserRank = leaderboard.findIndex(l => l.name === currentUser?.name && l.category === currentUser?.category) + 1;

      return React.createElement('div', { className: "min-h-screen bg-gray-50" },
        // Toast Notification
        toast && React.createElement('div', { 
          className: `toast ${toast.type}`,
          onClick: () => setToast(null)
        }, toast.message),

        // Custom Modal
        modal && React.createElement('div', { className: "custom-modal-backdrop", onClick: modal.showCancel ? modal.onCancel : null },
          React.createElement('div', { className: "custom-modal", onClick: (e) => e.stopPropagation() },
            React.createElement('div', { className: "modal-title" }, modal.title),
            React.createElement('div', { className: "modal-message" }, modal.message),
            React.createElement('div', { className: "modal-buttons" },
              modal.showCancel && React.createElement('button', {
                onClick: modal.onCancel,
                className: "modal-btn modal-btn-cancel"
              }, 'Cancel'),
              React.createElement('button', {
                onClick: modal.onConfirm,
                className: "modal-btn modal-btn-confirm"
              }, modal.confirmText)
            )
          )
        ),

        // Header with VCD Department
        React.createElement('div', { 
          className: "border-b border-gray-200 p-4 sticky top-0 z-50 shadow-sm",
          style: { background: 'linear-gradient(135deg, #fff5f0 0%, #fef3e7 100%)' }
        },
          React.createElement('div', { className: "flex items-center justify-between max-w-7xl mx-auto" },
            React.createElement('div', { className: "flex items-center gap-3" },
              React.createElement('div', null,
                React.createElement('h1', { className: "text-xl font-bold text-gray-800" }, 
                  'Seva Mela'
                ),
                React.createElement('p', { className: "text-sm text-orange-600 font-medium" }, 'VCD Department')
              ),
              isAdmin && React.createElement('div', { className: "text-right" },
              React.createElement('div', { className: "text-xl font-bold text-gray-800 bg-orange-100 px-3 py-1 rounded-lg border-2 border-orange-400" }, 'Admin')
            )
            ),
            !isAdmin && React.createElement('div', { className: "text-right" },
              React.createElement('div', { className: "text-xl font-bold text-gray-800" }, currentUser?.name),
              React.createElement('div', { className: "text-sm text-gray-500" }, `(${currentUser?.category})`)
            )
          ),
          
          // Progress bar with score and rank
          !isAdmin && React.createElement('div', { className: "mt-3 max-w-7xl mx-auto" },
            React.createElement('div', { className: "flex items-center gap-4" },
              React.createElement('div', { className: "flex-1" },
                React.createElement('div', { className: "progress-bar-container" },
                  React.createElement('div', {
                    className: "progress-fill",
                    style: { width: `${progress}%` }
                  })
                )
              ),
              React.createElement('div', { className: "flex gap-3" },
                React.createElement('div', { className: "text-center px-3 py-1 bg-orange-50 rounded-lg" },
                  React.createElement('div', { className: "text-xs text-gray-500" }, 'Score'),
                  React.createElement('div', { className: "text-lg font-bold text-orange-600" }, `${progress}%`)
                ),
                currentUserRank > 0 && React.createElement('div', { className: "text-center px-3 py-1 bg-blue-50 rounded-lg" },
                  React.createElement('div', { className: "text-xs text-gray-500" }, 'Rank'),
                  React.createElement('div', { className: "text-lg font-bold text-blue-600" }, `#${currentUserRank}`)
                )
              )
            )
          )
        ),

        // Main Content
        React.createElement('div', { className: "p-4 max-w-7xl mx-auto pb-24" },
          activeView === 'scores' && isAdmin ? React.createElement('div', null,
            React.createElement('div', { className: "flex items-center justify-between mb-4" },
              React.createElement('h2', { className: "text-2xl font-bold text-gray-800" }, 'Player Scores'),
            React.createElement('div', { className: "bg-white rounded-xl p-4 mb-4 shadow-sm" },
              React.createElement('div', { className: "flex gap-2 mb-3" },
                React.createElement('input', {
                  type: 'text',
                  placeholder: 'Search players...',
                  value: adminSearchQuery,
                  onChange: (e) => setAdminSearchQuery(e.target.value),
                  className: 'flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-orange-500'
                }),
                React.createElement('select', {
                  value: adminSortBy,
                  onChange: (e) => setAdminSortBy(e.target.value),
                  className: 'px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-orange-500'
                },
                  React.createElement('option', { value: 'rank' }, 'Sort by Rank'),
                  React.createElement('option', { value: 'name' }, 'Sort by Name')
                )
              )
            ),
            
              React.createElement('div', { className: "flex gap-2" },
                React.createElement('button', {
                  onClick: exportDataAsCSV,
                  className: "flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-medium hover:bg-green-600 transition-all"
                },
                  React.createElement(Icon, { name: 'Download', size: 16 }),
                  'Export CSV'
                ),
                React.createElement('label', {
                  className: "flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-all cursor-pointer"
                },
                  React.createElement(Icon, { name: 'Upload', size: 16 }),
                  'Import CSV',
                  React.createElement('input', {
                    type: "file",
                    accept: ".csv",
                    onChange: importDataFromCSV,
                    className: "hidden"
                  })
                ),
                React.createElement('button', {
                  onClick: handleRefresh,
                  className: "flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-all"
                },
                  React.createElement(Icon, { name: 'RotateCw', size: 16 }),
                  'Refresh'
                )
              )
            ),
            React.createElement('div', { className: "space-y-4" },
              getFilteredAdminScores().length === 0 ? React.createElement('div', { className: "text-center text-gray-500 py-8" },
                React.createElement('p', null, 'No players yet')
              ) : getFilteredAdminScores().map(player =>
                React.createElement('div', { 
                  key: `${player.name}-${player.category}`,
                  className: "bg-white rounded-xl shadow-sm border border-gray-200 p-4"
                },
                  // Player header
                  React.createElement('div', { className: "flex items-center justify-between mb-3 pb-3 border-b border-gray-200" },
                    React.createElement('div', null,
                      React.createElement('div', { className: "font-bold text-lg text-gray-800" }, player.name),
                      React.createElement('div', { className: "text-xs text-gray-500" }, player.category)
                    ),
                    React.createElement('div', { className: "text-2xl font-bold text-orange-600" }, `${player.totalPoints}%`)
                  ),
                  // Game scores grid
                  React.createElement('div', { className: "grid grid-cols-2 gap-3" },
                    player.gameScores.map(score =>
                      React.createElement('div', { 
                        key: score.gameId,
                        className: `p-3 rounded-lg ${score.scanned ? 'bg-orange-50 border border-orange-200' : 'bg-gray-50 border border-gray-200'}`
                      },
                        React.createElement('div', { className: "text-xs font-semibold text-gray-700 mb-1" }, score.gameName),
                        score.scanned 
                          ? React.createElement('div', { className: "flex gap-2 text-xs" },
                              score.gamePercent > 0 && React.createElement('div', { className: "font-bold text-green-600" }, `G:${score.gamePercent}%`),
                              React.createElement('div', { className: "font-bold text-orange-600" }, `S:${score.stagePercent}%`)
                            )
                          : React.createElement('div', { className: 'text-xs text-gray-400' }, 'Not started')
                      )
                    )
                  )
                )
              )
            )
          ) : React.createElement('div', null,
            isAdmin && React.createElement('div', { className: "flex items-center justify-between mb-4" },
              React.createElement('div', null),
              React.createElement('button', {
                onClick: handleRefresh,
                className: "flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-all"
              },
                React.createElement(Icon, { name: 'RotateCw', size: 16 }),
                'Refresh Scores'
              )
            ),

            // Game cards
            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4" },
              GAMES.map(game => {
                const gameData = currentUser?.games?.[game.id];
                const currentStage = gameData?.scanned ? game.stageName : 'Not Started';
                const pendingPlayers = isAdmin ? participants.filter(p => 
                  !p.isAdmin && 
                  p.games[game.id]?.scanned && 
                  game.gamePoints > 0 && 
                  p.games[game.id]?.coinsEarned === 0
                ) : [];

                return React.createElement('div', {
                  key: game.id,
                  className: `game-card ${isAdmin ? 'cursor-pointer' : ''}`,
                  onClick: () => isAdmin && setSelectedGame(game)
                },
                  React.createElement('img', {
                    src: game.image,
                    alt: game.name,
                    className: 'game-card-image',
                    onError: (e) => {
                      e.target.style.display = 'none';
                    }
                  }),
                  
                  React.createElement('div', { className: "p-4" },
                    React.createElement('div', { className: "flex items-start justify-between mb-3" },
                      React.createElement('div', null,
                        React.createElement('h3', { className: "font-bold text-lg text-gray-800 mb-1" }, game.name),
                        gameData?.scanned 
                          ? React.createElement('div', { className: "flex items-center gap-1" },
                              React.createElement('span', { className: "text-sm font-semibold text-orange-600" }, 'üîì ' + game.stageName),
                              React.createElement('span', { className: "text-xs text-gray-500" }, ' unlocked')
                            )
                          : React.createElement('p', { className: "text-sm text-gray-500" }, 'üîí Not Started')
                      ),
                      gameData?.scanned && !isAdmin && React.createElement('div', { 
                        className: "flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold" 
                      },
                        '‚úì'
                      )
                    ),

                    !isAdmin ? React.createElement('div', { className: "space-y-2" },
                      game.gamePoints > 0 && React.createElement('div', { className: "flex items-center justify-between text-sm" },
                        React.createElement('span', { className: "text-gray-600" }, 'Game Points'),
                        React.createElement('span', { className: "font-bold text-blue-600" }, `${gameData?.gamePercent || 0}%`)
                      ),
                      React.createElement('div', { className: "flex items-center justify-between text-sm" },
                        React.createElement('span', { className: "text-gray-600" }, 'Stage Points'),
                        React.createElement('span', { className: "font-bold text-orange-600" }, `${gameData?.stagePercent || 0}%`)
                      )
                    ) : React.createElement('div', { className: "flex items-center justify-between" },
                      React.createElement('span', { className: "text-sm text-gray-600" }, 'Pending'),
                      React.createElement('span', { 
                        className: `font-bold text-lg ${pendingPlayers.length > 0 ? 'text-red-600' : 'text-gray-400'}` 
                      }, pendingPlayers.length)
                    )
                  )
                );
              })
            )
          )
        ),

        // Success Modal
        successModalData && React.createElement('div', { className: "modal-backdrop" },
          React.createElement('div', { className: "success-modal" },
            React.createElement('div', { className: "text-center" },
              React.createElement('div', { className: "text-6xl mb-3 animate-bounce" }, 'üéâ'),
              React.createElement('div', { className: "success-checkmark" },
                React.createElement(Icon, { name: 'Check', size: 48, className: 'text-white' })
              ),
              React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-2" }, 
                `${successModalData.game.stageName} Unlocked!`
              ),
              React.createElement('p', { className: "text-lg font-semibold text-orange-600 mb-3" },
                successModalData.game.name
              ),
              React.createElement('p', { className: "text-sm italic text-gray-600 mb-4 px-4" },
                `"${successModalData.game.stageSlogan}"`
              ),
              React.createElement('div', { className: "bg-orange-50 rounded-xl p-4 mb-4 border border-orange-200" },
                React.createElement('div', { className: "text-sm text-gray-600 mb-1" },
                  `Stage ${successModalData.scannedCount} of ${GAMES.length}`
                ),
                React.createElement('div', { className: "text-3xl font-bold text-orange-600" },
                  `${successModalData.totalProgress}%`
                )
              ),
              React.createElement('p', { className: "text-sm text-gray-500" },
                successModalData.scannedCount === GAMES.length 
                  ? 'Journey complete! üôè' 
                  : 'Continue your journey...'
              )
            )
          )
        ),

        // QR Scanner Modal
        showQRScanner && React.createElement('div', { className: "modal-backdrop", onClick: stopQRScanner },
          React.createElement('div', {
            className: "fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md z-9999",
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('div', { className: "flex justify-between items-center mb-4" },
              React.createElement('h3', { className: "text-xl font-bold text-gray-800" }, 'Scan QR Code'),
              React.createElement('button', {
                onClick: stopQRScanner,
                className: "text-gray-400 hover:text-gray-600"
              },
                React.createElement(Icon, { name: 'X', size: 24 })
              )
            ),
            React.createElement('div', { id: "qr-reader", className: "mb-4 rounded-xl overflow-hidden" }),
            React.createElement('p', { className: "text-sm text-gray-600 text-center" }, 'Position the QR code within the frame')
          )
        ),

        // Leaderboard
        showLeaderboard && React.createElement('div', { className: "modal-backdrop", onClick: () => setShowLeaderboard(false) },
          React.createElement('div', {
            className: "leaderboard-slide p-6",
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('div', { className: "flex justify-between items-center mb-6" },
              React.createElement('h3', { className: "text-2xl font-bold text-gray-800 flex items-center gap-2" },
                React.createElement(Icon, { name: 'Trophy', size: 28, className: 'text-orange-600' }),
                'Leaderboard'
              ),
              React.createElement('button', {
                onClick: () => setShowLeaderboard(false),
                className: "text-gray-400 hover:text-gray-600"
              },
                React.createElement(Icon, { name: 'X', size: 24 })
              )
            ),

            !isAdmin && currentUserRank > 0 && React.createElement('div', { className: "bg-gradient-to-r from-orange-50 to-blue-50 border-2 border-orange-400 rounded-xl p-4 mb-6" },
              React.createElement('div', { className: "flex justify-between items-center" },
                React.createElement('div', null,
                  React.createElement('div', { className: "font-bold text-gray-800" }, `${currentUser.name}`),
                  React.createElement('div', { className: "text-sm text-gray-600" }, `${currentUser.category}`)
                ),
                React.createElement('div', { className: "text-right" },
                  React.createElement('div', { className: "text-3xl font-bold text-orange-600" }, `${progress}%`),
                  React.createElement('div', { className: "text-xs text-gray-600" }, `Rank #${currentUserRank}`)
                )
              )
            ),

            leaderboard.length === 0 ? React.createElement('div', { className: "text-center text-gray-500 py-12" },
              React.createElement('p', null, 'No participants yet')
            ) : React.createElement('div', { className: "space-y-3" },
              leaderboard.map((player) => {
                const getTrophyEmoji = (rank) => {
                  if (rank === 1) return 'ü•á';
                  if (rank === 2) return 'ü•à';
                  if (rank === 3) return 'ü•â';
                  return 'üèÖ';
                };
                const getTrophyColor = (rank) => {
                  if (rank === 1) return 'text-yellow-500';
                  if (rank === 2) return 'text-gray-400';
                  if (rank === 3) return 'text-orange-600';
                  return 'text-blue-500';
                };
                return React.createElement('div', {
                  key: `${player.name}-${player.category}`,
                  className: `p-4 rounded-xl border-2 ${
                    player.rank <= 3 ? 'bg-gradient-to-r from-yellow-50 to-amber-50 border-yellow-400' : 'bg-white border-gray-200'
                  }`
                },
                  React.createElement('div', { className: "flex justify-between items-center" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                      React.createElement('div', { className: `text-3xl ${getTrophyColor(player.rank)}` },
                        getTrophyEmoji(player.rank)
                      ),
                      React.createElement('div', null,
                        React.createElement('div', { className: "font-bold text-gray-800" }, player.name),
                        React.createElement('div', { className: "text-xs text-gray-600" }, player.category)
                      )
                    ),
                    React.createElement('div', { className: "flex items-center gap-3" },
                      React.createElement('div', { className: `text-2xl font-bold ${player.rank <= 3 ? getTrophyColor(player.rank) : 'text-orange-600'}` }, `${player.totalPercentage}%`),
                      isAdmin && React.createElement('button', {
                        onClick: (e) => {
                          e.stopPropagation();
                          deletePlayer(player.name, player.category);
                        },
                        className: "p-2 text-red-500 hover:bg-red-50 rounded-lg transition-all"
                      },
                        React.createElement(Icon, { name: 'Trash2', size: 18 })
                      )
                    )
                  )
                );
              })
            )
          )
        ),

        // Admin Game Modal
        isAdmin && selectedGame && React.createElement('div', { className: "modal-backdrop", onClick: () => setSelectedGame(null) },
          React.createElement('div', {
            className: "fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl p-6 w-full max-w-lg z-9999 max-h-[80vh] overflow-y-auto",
            onClick: (e) => e.stopPropagation()
          },
            React.createElement('div', { className: "flex justify-between items-center mb-6" },
              React.createElement('h3', { className: "text-xl font-bold text-gray-800" }, selectedGame.name),
              React.createElement('button', {
                onClick: () => setSelectedGame(null),
                className: "text-gray-400 hover:text-gray-600"
              },
                React.createElement(Icon, { name: 'X', size: 24 })
              )
            ),

            React.createElement('h4', { className: "font-bold text-gray-700 mb-4" }, 'Pending Players'),

            React.createElement('div', { className: "space-y-4" },
              participants.filter(p => {
                if (!p || p.isAdmin) return false;
                if (!p.games || !p.games[selectedGame.id]) return false;
                if (!p.games[selectedGame.id].scanned) return false;
                if (selectedGame.gamePoints <= 0) return false;
                if (p.games[selectedGame.id].coinsEarned > 0) return false;
                return true;
              }).length === 0 ? React.createElement('div', { className: "text-center text-gray-500 py-8" },
                React.createElement('p', null, 'No pending players')
              ) : participants.filter(p => {
                if (!p || p.isAdmin) return false;
                if (!p.games || !p.games[selectedGame.id]) return false;
                if (!p.games[selectedGame.id].scanned) return false;
                if (selectedGame.gamePoints <= 0) return false;
                if (p.games[selectedGame.id].coinsEarned > 0) return false;
                return true;
              }).map(player => 
                React.createElement('div', {
                  key: `${player.name}-${player.category}`,
                  className: "bg-gray-50 border border-gray-200 rounded-xl p-4"
                },
                  React.createElement('div', { className: "font-bold text-gray-800 mb-3" },
                    `${player.name} (${player.category})`
                  ),
                  React.createElement('div', { className: "flex gap-2" },
                    React.createElement('input', {
                      type: "number",
                      id: `points-${player.name}-${player.category}`,
                      placeholder: `Coins (0-${selectedGame.maxCoins})`,
                      min: "0",
                      max: selectedGame.maxCoins.toString(),
                      className: "flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                    }),
                    React.createElement('button', {
                      onClick: async () => {
                        const input = document.getElementById(`points-${player.name}-${player.category}`);
                        const coins = parseInt(input.value) || 0;
                        
                        const result = await showConfirm('Award Points', `Award ${coins} coins to ${player.name}?`);
                        if (result && awardGamePoints(player.name, player.category, selectedGame.id, coins)) {
                          const gamePercent = selectedGame.maxCoins > 0 ? Math.round((coins / selectedGame.maxCoins) * selectedGame.gamePoints) : 0;
                          showToast(`‚úì ${coins} coins = ${gamePercent}%`, 'success');
                          input.value = '';
                        }
                      },
                      className: "px-6 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg font-bold hover:scale-105 transition-all"
                    }, 'Award')
                  )
                )
              )
            )
          )
        ),

        // Bottom Navigation
        React.createElement('div', { className: "bottom-nav" },
          React.createElement('div', { className: "flex max-w-7xl mx-auto" },
            !isAdmin && React.createElement('button', {
              onClick: startQRScanner,
              className: "nav-button"
            },
              React.createElement('div', { style: { fontSize: '24px' } }, 'üì∑'),
              React.createElement('div', { className: "nav-label" }, 'Scan')
            ),
            React.createElement('button', {
              onClick: () => setShowLeaderboard(true),
              className: `nav-button ${showLeaderboard ? 'active' : ''}`
            },
              React.createElement('div', { style: { fontSize: '24px' } }, 'üèÜ'),
              React.createElement('div', { className: "nav-label" }, 'Board')
            ),
            React.createElement('button', {
              onClick: refreshScores,
              className: `nav-button ${refreshing ? 'active' : ''}`
            },
              React.createElement('div', { style: { fontSize: '24px' } }, 'üîÑ'),
              React.createElement('div', { className: "nav-label" }, 'Refresh')
            ),
            isAdmin && React.createElement('button', {
              onClick: () => setActiveView(activeView === 'scores' ? 'home' : 'scores'),
              className: `nav-button ${activeView === 'scores' ? 'active' : ''}`
            },
              React.createElement('div', { style: { fontSize: '24px' } }, 'üìä'),
              React.createElement('div', { className: "nav-label" }, 'Scores')
            ),
            React.createElement('button', {
              onClick: async () => {
                const result = await showConfirm('Logout', 'Are you sure you want to logout?');
                if (result) {
                  localStorage.removeItem('sevaMelaCurrentUser');
                  window.location.reload();
                }
              },
              className: "nav-button"
            },
              React.createElement('div', { style: { fontSize: '24px' } }, 'üö™'),
              React.createElement('div', { className: "nav-label" }, 'Logout')
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(SevaMelaApp));
  </script>
</body>
</html>